
select count(*) from (
select pos_transaction_number, 
  pivot(d.date::varchar, sales_dollar_amount using parameters columnsFilter = '2003-01-01,2003-01-02,2003-01-03,2003-01-04,2003-01-05,2003-01-06,2003-01-07,2003-01-08,2003-01-09,2003-01-10,2003-01-11,2003-01-12,2003-01-13,2003-01-14,2003-01-15,2003-01-16,2003-01-17,2003-01-18,2003-01-19,2003-01-20,2003-01-21,2003-01-22,2003-01-23,2003-01-24,2003-01-25,2003-01-26,2003-01-27,2003-01-28,2003-01-29,2003-01-30,2003-01-31,2003-02-01,2003-02-02,2003-02-03,2003-02-04,2003-02-05,2003-02-06,2003-02-07,2003-02-08,2003-02-09,2003-02-10,2003-02-11,2003-02-12,2003-02-13,2003-02-14,2003-02-15,2003-02-16,2003-02-17,2003-02-18,2003-02-19,2003-02-20,2003-02-21,2003-02-22,2003-02-23,2003-02-24,2003-02-25,2003-02-26,2003-02-27,2003-02-28,2003-03-01,2003-03-02,2003-03-03,2003-03-04,2003-03-05,2003-03-06,2003-03-07,2003-03-08,2003-03-09,2003-03-10,2003-03-11,2003-03-12,2003-03-13,2003-03-14,2003-03-15,2003-03-16,2003-03-17,2003-03-18,2003-03-19,2003-03-20,2003-03-21', separator = ',', method = 'LAST') over(partition by pos_transaction_number order by d.date)
from online_sales.online_sales_fact f 
  inner join date_dimension d on f.sale_date_key = d.date_key 
order by pos_transaction_number 
) t
;


select count(*) from (
select pos_transaction_number, 
  pivot(d.date::varchar, sales_quantity, sales_dollar_amount using parameters columnsFilter = '2003-01-01,2003-01-02,2003-01-03,2003-01-04,2003-01-05,2003-01-06,2003-01-07,2003-01-08,2003-01-09,2003-01-10,2003-01-11,2003-01-12,2003-01-13,2003-01-14,2003-01-15,2003-01-16,2003-01-17,2003-01-18,2003-01-19,2003-01-20,2003-01-21,2003-01-22,2003-01-23,2003-01-24,2003-01-25,2003-01-26,2003-01-27,2003-01-28,2003-01-29,2003-01-30,2003-01-31,2003-02-01,2003-02-02,2003-02-03,2003-02-04,2003-02-05,2003-02-06,2003-02-07,2003-02-08,2003-02-09,2003-02-10,2003-02-11,2003-02-12,2003-02-13,2003-02-14,2003-02-15,2003-02-16,2003-02-17,2003-02-18,2003-02-19,2003-02-20,2003-02-21,2003-02-22,2003-02-23,2003-02-24,2003-02-25,2003-02-26,2003-02-27,2003-02-28,2003-03-01,2003-03-02,2003-03-03,2003-03-04,2003-03-05,2003-03-06,2003-03-07,2003-03-08,2003-03-09,2003-03-10,2003-03-11,2003-03-12,2003-03-13,2003-03-14,2003-03-15,2003-03-16,2003-03-17,2003-03-18,2003-03-19,2003-03-20,2003-03-21', separator = ',', method = 'LAST') over(partition by pos_transaction_number order by d.date)
from online_sales.online_sales_fact f 
  inner join date_dimension d on f.sale_date_key = d.date_key 
order by pos_transaction_number 
) t
;

select count(*) from (
select * from 
(select pos_transaction_number, 
  pivot(d.date::varchar, sales_quantity using parameters columnsFilter = '2003-01-01,2003-01-02,2003-01-03,2003-01-04,2003-01-05,2003-01-06,2003-01-07,2003-01-08,2003-01-09,2003-01-10,2003-01-11,2003-01-12,2003-01-13,2003-01-14,2003-01-15,2003-01-16,2003-01-17,2003-01-18,2003-01-19,2003-01-20,2003-01-21,2003-01-22,2003-01-23,2003-01-24,2003-01-25,2003-01-26,2003-01-27,2003-01-28,2003-01-29,2003-01-30,2003-01-31,2003-02-01,2003-02-02,2003-02-03,2003-02-04,2003-02-05,2003-02-06,2003-02-07,2003-02-08,2003-02-09,2003-02-10,2003-02-11,2003-02-12,2003-02-13,2003-02-14,2003-02-15,2003-02-16,2003-02-17,2003-02-18,2003-02-19,2003-02-20,2003-02-21,2003-02-22,2003-02-23,2003-02-24,2003-02-25,2003-02-26,2003-02-27,2003-02-28,2003-03-01,2003-03-02,2003-03-03,2003-03-04,2003-03-05,2003-03-06,2003-03-07,2003-03-08,2003-03-09,2003-03-10,2003-03-11,2003-03-12,2003-03-13,2003-03-14,2003-03-15,2003-03-16,2003-03-17,2003-03-18,2003-03-19,2003-03-20,2003-03-21', separator = ',', method = 'LAST') over(partition by pos_transaction_number order by d.date)
from online_sales.online_sales_fact f 
  inner join date_dimension d on f.sale_date_key = d.date_key 
) t1, 
(select pos_transaction_number, 
  pivot(d.date::varchar, sales_dollar_amount using parameters columnsFilter = '2003-01-01,2003-01-02,2003-01-03,2003-01-04,2003-01-05,2003-01-06,2003-01-07,2003-01-08,2003-01-09,2003-01-10,2003-01-11,2003-01-12,2003-01-13,2003-01-14,2003-01-15,2003-01-16,2003-01-17,2003-01-18,2003-01-19,2003-01-20,2003-01-21,2003-01-22,2003-01-23,2003-01-24,2003-01-25,2003-01-26,2003-01-27,2003-01-28,2003-01-29,2003-01-30,2003-01-31,2003-02-01,2003-02-02,2003-02-03,2003-02-04,2003-02-05,2003-02-06,2003-02-07,2003-02-08,2003-02-09,2003-02-10,2003-02-11,2003-02-12,2003-02-13,2003-02-14,2003-02-15,2003-02-16,2003-02-17,2003-02-18,2003-02-19,2003-02-20,2003-02-21,2003-02-22,2003-02-23,2003-02-24,2003-02-25,2003-02-26,2003-02-27,2003-02-28,2003-03-01,2003-03-02,2003-03-03,2003-03-04,2003-03-05,2003-03-06,2003-03-07,2003-03-08,2003-03-09,2003-03-10,2003-03-11,2003-03-12,2003-03-13,2003-03-14,2003-03-15,2003-03-16,2003-03-17,2003-03-18,2003-03-19,2003-03-20,2003-03-21', separator = ',', method = 'LAST') over(partition by pos_transaction_number order by d.date)
from online_sales.online_sales_fact f 
  inner join date_dimension d on f.sale_date_key = d.date_key 
) t2
where t1.pos_transaction_number = t2.pos_transaction_number
order by t1.pos_transaction_number 
) t
;

